<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gm.modules.user.dao.UserDao">
    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.gm.modules.user.entity.UserEntity" id="userMap">
        <result property="userId" column="USER_ID"/>
        <result property="userName" column="USER_NAME"/>
        <result property="address" column="ADDRESS"/>
        <result property="userLevelId" column="USER_LEVEL_ID"/>
        <result property="userType" column="USER_TYPE"/>
        <result property="clientIp" column="CLIENT_IP"/>
        <result property="status" column="STATUS"/>
        <result property="createTime" column="CREATE_TIME"/>
        <result property="createTimeTs" column="CREATE_TIME_TS"/>
        <result property="updateTime" column="UPDATE_TIME"/>
        <result property="updateTimeTs" column="UPDATE_TIME_TS"/>
        <result property="expandCode" column="EXPAND_CODE"/>
        <result property="deviceType" column="DEVICE_TYPE"/>
        <result property="createUser" column="CREATE_USER"/>
        <result property="updateUser" column="UPDATE_USER"/>
        <result property="remark" column="REMARK"/>
        <result property="imgUrl" column="IMG_URL"/>
        <result property="onlineFlag" column="ONLINE_FLAG"/>
        <result property="fatherId" column="FATHER_ID"/>
        <result property="grandFatherId" column="GRANDFATHER_ID"/>
        <result property="vipLevelId" column="VIP_LEVEL_ID"/>
        <result property="expandCodeViewTimes" column="EXPAND_CODE_VIEW_TIMES"/>
    </resultMap>

    <select id="queryEffectiveUserCount" resultType="int">
    SELECT
        COUNT( DISTINCT A.USER_ID )
    FROM
        gm_transaction_order A
        LEFT JOIN gm_user B ON A.USER_ID = B.USER_ID
    WHERE
        B.FATHER_ID = #{userId}
        AND A.`STATUS` = '1'
        AND A.CURRENCY_TYPE = '1'
    </select>


    <!--获取玩家信息-->
    <select id="getPlayerInfo" resultType="com.gm.modules.user.rsp.UserInfoRsp">
        SELECT
        (
        SELECT
        COUNT(*)
        FROM
        gm_user_hero
        WHERE
        USER_ID = a.USER_ID
        AND `STATUS` = '1'
        ) AS hero_count,
        (
        SELECT
        COUNT(*)
        FROM
        gm_user_hero
        WHERE
        USER_ID = a.USER_ID
        AND `STATUS` = '1'
        AND SKIN_TYPE = 1
        ) AS gold_hero_count,
        (
        SELECT
        COUNT(*)
        FROM
        gm_user_equipment
        WHERE
        USER_ID = a.USER_ID
        AND `STATUS` != '0'
        ) AS equipment_count,
        b.LEVEL_CODE,
        b.PROMOTION_EXPERIENCE,
        b.EXPERIENCE_TOTAL,
        c.TOTAL_AMOUNT AS mr_coins,
        a.ADDRESS AS ADDRESS,
        a.TOTAL_POWER AS POWER,
        a.IMG_URL,
        a.FTG,
        d.VIP_LEVEL_CODE,
        d.VIP_LEVEL_NAME,
        d.VIP_IMG_URL
        FROM
        gm_user a
        LEFT JOIN gm_user_level b ON a.USER_LEVEL_ID = b.ID
        LEFT JOIN gm_user_account c ON a.USER_ID = c.USER_ID
        LEFT JOIN gm_user_vip_level d ON a.VIP_LEVEL_ID = d.VIP_LEVEL_ID
        <where>
            <if test="address != null and address != ''">
                AND a.ADDRESS = #{address}
            </if>
        </where>
    </select>

</mapper>